---
import { Image } from 'astro:assets';
import { getCollection } from 'astro:content';
import BaseHead from '../components/BaseHead.astro';
import Footer from '../components/Footer.astro';
import FormattedDate from '../components/FormattedDate.astro';
import Header from '../components/Header.astro';
import { SITE_DESCRIPTION, SITE_TITLE } from '../consts';

const allPosts = (await getCollection('blog')).sort(
	(a, b) => new Date(b.data.pubDate).getTime() - new Date(a.data.pubDate).getTime()
);

// Separate featured post (latest) from remaining posts
const featuredPost = allPosts[0];
const remainingPosts = allPosts.slice(1);
---

<!doctype html>
<html lang="en">
	<head>
		<BaseHead title={SITE_TITLE} description={SITE_DESCRIPTION} />
		<style>
			/* Full page hero without header */
			.hero-container {
				min-height: 100vh;
				background-image: url('${featuredPost.data.heroImage?.src || ''}');
				background-size: cover;
				background-position: center;
				background-repeat: no-repeat;
				position: relative;
			}

			.hero-overlay-bg {
				position: absolute;
				top: 0;
				left: 0;
				right: 0;
				bottom: 0;
				background: rgba(0, 0, 0, 0.5);
				z-index: 1;
			}

			/* Hero content - full viewport now */
			.hero-content {
				position: relative;
				z-index: 2;
				display: flex;
				align-items: center;
				justify-content: center;
				min-height: 100vh;
				text-align: center;
				color: white;
				padding: 3rem 2rem;
			}

			/* Articles section */
			.articles-container {
				max-width: 1200px;
				margin: 0 auto;
				padding: 0 1rem;
			}

			/* Responsive grid */
			@media (max-width: 768px) {
				.articles-container {
					padding: 0 0.5rem;
				}
			}
		</style>
	</head>
	<body>
		<!-- Full page hero background -->
		<div class="hero-container" style={`background-image: url('${featuredPost.data.heroImage?.src || ''}');`}>
			<div class="hero-overlay-bg"></div>

			<!-- Hero content -->
			<div class="hero-content">
				<div class="max-w-4xl mx-auto px-4 text-left">
					<h1 class="mb-8 text-5xl font-bold leading-tight">
						{featuredPost.data.title}
					</h1>
					<p class="mb-8 text-xl leading-relaxed">
						{featuredPost.data.description}
					</p>
					<a href={`${import.meta.env.BASE_URL}/${featuredPost.id}/`} class="btn btn-primary btn-lg">
						Read Full Article →
					</a>
				</div>
			</div>
		</div>

		<!-- Articles Section using DaisyUI Cards -->
		<section class="bg-base-200 py-16">
			<div class="articles-container">
				<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
					{remainingPosts.map((post) => (
						<div class="card bg-base-100 shadow-xl hover:shadow-2xl transition-shadow duration-300">
							{post.data.heroImage && (
								<figure class="px-4 pt-4">
									<Image
										width={400}
										height={200}
										src={post.data.heroImage}
										alt={post.data.title}
										class="rounded-xl w-full h-48 object-cover"
									/>
								</figure>
							)}
							<div class="card-body">
								<h3 class="card-title text-2xl mb-2">
									{post.data.title}
								</h3>
								<p class="text-base-content/70 text-sm mb-3">
									<FormattedDate date={post.data.pubDate} />
								</p>
								<p class="text-base-content/80 leading-relaxed mb-4">
									{post.data.description}
								</p>
								<div class="card-actions justify-end">
									<a href={`${import.meta.env.BASE_URL}/${post.id}/`} class="btn btn-primary btn-sm">
										Read more →
									</a>
								</div>
							</div>
						</div>
					))}
				</div>
			</div>
		</section>

		<Footer />
	</body>
</html>
